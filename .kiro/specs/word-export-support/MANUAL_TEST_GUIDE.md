# Word 导出功能 - 手动测试指南

## 测试概述

本指南提供了 Word 导出功能的全面手动测试流程，涵盖不同类型的文档、不同的 Word 软件以及各种边缘情况。

## 测试环境准备

### 必需软件
- [ ] Microsoft Word (Windows/Mac) - 任意版本
- [ ] WPS Office - 最新版本
- [ ] LibreOffice Writer - 最新版本
- [ ] 浏览器 (Chrome/Firefox/Safari)

### 测试数据准备
运行以下命令生成测试数据：
```bash
npm run test:manual:setup
```

---

## 测试类别 1: 不同类型的文档

### 1.1 纯文本文档

**测试步骤：**
1. 在应用中创建或导入一个纯文本文档
2. 点击下载按钮，选择 Word (.docx) 格式
3. 使用 Microsoft Word 打开下载的文件
4. 使用 WPS Office 打开下载的文件
5. 使用 LibreOffice Writer 打开下载的文件

**预期结果：**
- [ ] 文件可以在所有三个软件中正常打开
- [ ] 文本内容完整显示
- [ ] 没有格式错误或乱码
- [ ] 文件大小合理（< 100KB）

**测试文档示例：**
```
这是一个纯文本文档。
包含多个段落。

第二段落。
第三段落。
```

---

### 1.2 富文本文档（包含标题、列表、表格）

**测试步骤：**
1. 导入包含以下元素的文档：
   - H1-H6 标题
   - 有序列表和无序列表
   - 表格（至少 3x3）
   - 粗体、斜体、删除线文本
2. 下载为 Word 格式
3. 在三个软件中打开并验证

**预期结果：**
- [ ] 标题层级正确（H1 最大，H6 最小）
- [ ] 列表类型正确（有序/无序）
- [ ] 列表缩进层级正确
- [ ] 表格结构完整（行列数正确）
- [ ] 表格边框显示正常
- [ ] 文本样式保留（粗体、斜体、删除线）

**测试文档示例：**
```html
<h1>一级标题</h1>
<h2>二级标题</h2>
<h3>三级标题</h3>

<p>这是一段包含 <strong>粗体</strong>、<em>斜体</em> 和 <del>删除线</del> 的文本。</p>

<ul>
  <li>无序列表项 1</li>
  <li>无序列表项 2
    <ul>
      <li>嵌套项 2.1</li>
      <li>嵌套项 2.2</li>
    </ul>
  </li>
</ul>

<ol>
  <li>有序列表项 1</li>
  <li>有序列表项 2</li>
  <li>有序列表项 3</li>
</ol>

<table>
  <tr>
    <th>列1</th>
    <th>列2</th>
    <th>列3</th>
  </tr>
  <tr>
    <td>数据1</td>
    <td>数据2</td>
    <td>数据3</td>
  </tr>
  <tr>
    <td>数据4</td>
    <td>数据5</td>
    <td>数据6</td>
  </tr>
</table>
```

---

### 1.3 包含图片的文档

**测试步骤：**
1. 导入包含多张图片的文档（至少 5 张）
2. 图片应包含不同格式：JPG、PNG、GIF
3. 下载为 Word 格式
4. 在三个软件中打开并验证

**预期结果：**
- [ ] 所有图片都正确显示
- [ ] 图片尺寸比例正确
- [ ] 图片对齐方式正确
- [ ] 图片清晰度良好
- [ ] 文件大小合理（图片已内嵌）

**注意事项：**
- 检查图片是否真正内嵌（断网后仍能查看）
- 验证图片质量没有明显损失

---

### 1.4 包含代码块的文档

**测试步骤：**
1. 导入包含代码块的文档
2. 代码块应包含不同语言：JavaScript、Python、HTML
3. 下载为 Word 格式
4. 在三个软件中打开并验证

**预期结果：**
- [ ] 代码块使用等宽字体
- [ ] 代码缩进保留
- [ ] 代码换行正确
- [ ] 代码块与正文区分明显
- [ ] 特殊字符正确显示

**测试文档示例：**
```html
<h2>JavaScript 代码示例</h2>
<pre><code>
function hello(name) {
  console.log(`Hello, ${name}!`);
  return true;
}
</code></pre>

<h2>Python 代码示例</h2>
<pre><code>
def hello(name):
    print(f"Hello, {name}!")
    return True
</code></pre>
```

---

### 1.5 Lake 格式文档

**测试步骤：**
1. 从语雀导出一个 Lake 格式文档
2. 确保文档包含 `<card>` 标签
3. 下载为 Word 格式
4. 在三个软件中打开并验证

**预期结果：**
- [ ] Lake 格式正确解析
- [ ] 卡片内容正确转换
- [ ] 图片卡片转换为图片
- [ ] 代码块卡片转换为代码块
- [ ] 其他卡片类型正确处理

---

## 测试类别 2: 不同的 Word 软件

### 2.1 Microsoft Word (Windows)

**测试步骤：**
1. 在 Windows 系统上安装 Microsoft Word
2. 打开各类测试文档
3. 验证格式和内容

**预期结果：**
- [ ] 所有文档都能正常打开
- [ ] 格式完全正确
- [ ] 没有兼容性警告
- [ ] 可以正常编辑

---

### 2.2 Microsoft Word (Mac)

**测试步骤：**
1. 在 Mac 系统上安装 Microsoft Word
2. 打开各类测试文档
3. 验证格式和内容

**预期结果：**
- [ ] 所有文档都能正常打开
- [ ] 格式与 Windows 版本一致
- [ ] 没有兼容性警告
- [ ] 可以正常编辑

---

### 2.3 WPS Office

**测试步骤：**
1. 安装 WPS Office（Windows 或 Mac）
2. 打开各类测试文档
3. 验证格式和内容

**预期结果：**
- [ ] 所有文档都能正常打开
- [ ] 格式基本正确（允许细微差异）
- [ ] 没有严重的兼容性问题
- [ ] 可以正常编辑

**已知差异：**
- WPS 可能对某些样式有不同的渲染
- 表格边框样式可能略有不同

---

### 2.4 LibreOffice Writer

**测试步骤：**
1. 安装 LibreOffice Writer
2. 打开各类测试文档
3. 验证格式和内容

**预期结果：**
- [ ] 所有文档都能正常打开
- [ ] 格式基本正确（允许细微差异）
- [ ] 没有严重的兼容性问题
- [ ] 可以正常编辑

**已知差异：**
- LibreOffice 对某些 Office Open XML 特性的支持可能不完整
- 字体渲染可能略有不同

---

## 测试类别 3: 边缘情况

### 3.1 空文档

**测试步骤：**
1. 创建一个完全空的文档（无内容）
2. 下载为 Word 格式
3. 打开并验证

**预期结果：**
- [ ] 文件可以正常生成
- [ ] 文件可以正常打开
- [ ] 显示文档标题（如果有）
- [ ] 没有错误或崩溃

---

### 3.2 超大文档（>1000 段落）

**测试步骤：**
1. 生成一个包含 1000+ 段落的文档
2. 下载为 Word 格式
3. 打开并验证

**预期结果：**
- [ ] 文件可以在 30 秒内生成
- [ ] 文件大小合理（< 100MB）
- [ ] 文件可以正常打开
- [ ] 所有内容都正确显示
- [ ] 没有性能问题

**性能指标：**
- 生成时间：< 30 秒
- 文件大小：< 50MB（纯文本）
- 打开时间：< 10 秒

---

### 3.3 特殊字符（中文、emoji、符号）

**测试步骤：**
1. 创建包含以下内容的文档：
   - 中文字符
   - 日文字符
   - emoji 表情
   - 特殊符号（©、®、™、€、£、¥）
   - 数学符号（∑、∫、√、π）
2. 下载为 Word 格式
3. 打开并验证

**预期结果：**
- [ ] 所有字符都正确显示
- [ ] 没有乱码
- [ ] emoji 正确渲染
- [ ] 特殊符号正确显示

**测试文档示例：**
```
中文测试：你好世界
日文测试：こんにちは世界
Emoji 测试：😀 😃 😄 😁 🎉 🎊
特殊符号：© ® ™ € £ ¥
数学符号：∑ ∫ √ π ∞
```

---

### 3.4 超大图片（>10MB）

**测试步骤：**
1. 创建包含超大图片的文档（单张图片 > 10MB）
2. 下载为 Word 格式
3. 检查日志中的警告信息
4. 打开并验证

**预期结果：**
- [ ] 系统记录警告日志
- [ ] 文档仍然可以生成
- [ ] 图片可以正常显示（可能被压缩）
- [ ] 文件大小合理

**注意事项：**
- 检查控制台日志中的警告信息
- 验证图片质量是否可接受

---

## 测试类别 4: 错误处理

### 4.1 网络错误（图片下载失败）

**测试步骤：**
1. 创建包含无效图片 URL 的文档
2. 或在下载过程中断开网络
3. 下载为 Word 格式
4. 检查日志和结果

**预期结果：**
- [ ] 系统记录警告日志
- [ ] 文档仍然可以生成
- [ ] 失败的图片被跳过
- [ ] 其他内容正常显示

**测试 URL：**
```
https://invalid-domain-that-does-not-exist.com/image.jpg
https://httpstat.us/404
https://httpstat.us/500
```

---

### 4.2 超时（30 秒）

**测试步骤：**
1. 创建一个非常复杂的文档（大量图片 + 大量内容）
2. 或模拟慢速网络
3. 尝试下载为 Word 格式
4. 观察是否触发超时

**预期结果：**
- [ ] 如果超过 30 秒，系统应该中止生成
- [ ] 显示友好的错误信息
- [ ] 建议用户尝试其他格式
- [ ] 不会导致应用崩溃

---

### 4.3 磁盘空间不足

**测试步骤：**
1. 模拟磁盘空间不足的情况（需要管理员权限）
2. 尝试下载 Word 文档
3. 观察错误处理

**预期结果：**
- [ ] 系统检测到磁盘空间不足
- [ ] 显示友好的错误信息
- [ ] 不会导致应用崩溃
- [ ] 不会损坏现有文件

**注意：** 此测试可能需要特殊环境，可以跳过

---

## 测试类别 5: 缓存机制

### 5.1 缓存优先策略

**测试步骤：**
1. 第一次下载某个文档的 Word 格式
2. 记录生成时间
3. 第二次下载同一文档的 Word 格式
4. 记录生成时间

**预期结果：**
- [ ] 第二次下载明显更快
- [ ] 文件内容完全相同
- [ ] 日志显示使用了缓存

---

### 5.2 动态生成回退

**测试步骤：**
1. 删除某个文档的 Word 缓存文件
2. 尝试下载该文档
3. 观察系统行为

**预期结果：**
- [ ] 系统检测到缓存不存在
- [ ] 自动动态生成新的 Word 文档
- [ ] 生成成功并可以下载
- [ ] 新文件被缓存

---

## 测试类别 6: 批量导出

### 6.1 批量导出多个文档

**测试步骤：**
1. 选择多个文档（至少 10 个）
2. 执行批量导出任务
3. 观察导出过程

**预期结果：**
- [ ] 所有文档都生成 Word 格式
- [ ] 任务状态正确更新
- [ ] 日志记录详细信息
- [ ] 部分失败不影响其他文档

---

### 6.2 部分失败容错

**测试步骤：**
1. 在批量导出中包含一些有问题的文档
2. 执行批量导出
3. 观察错误处理

**预期结果：**
- [ ] 失败的文档被记录
- [ ] 其他文档继续处理
- [ ] 任务最终完成
- [ ] 错误日志详细记录失败原因

---

## 测试报告模板

### 测试执行记录

| 测试类别 | 测试项 | 状态 | 备注 |
|---------|--------|------|------|
| 1.1 | 纯文本文档 | ✅/❌ | |
| 1.2 | 富文本文档 | ✅/❌ | |
| 1.3 | 包含图片的文档 | ✅/❌ | |
| 1.4 | 包含代码块的文档 | ✅/❌ | |
| 1.5 | Lake 格式文档 | ✅/❌ | |
| 2.1 | Microsoft Word (Windows) | ✅/❌ | |
| 2.2 | Microsoft Word (Mac) | ✅/❌ | |
| 2.3 | WPS Office | ✅/❌ | |
| 2.4 | LibreOffice Writer | ✅/❌ | |
| 3.1 | 空文档 | ✅/❌ | |
| 3.2 | 超大文档 | ✅/❌ | |
| 3.3 | 特殊字符 | ✅/❌ | |
| 3.4 | 超大图片 | ✅/❌ | |
| 4.1 | 网络错误 | ✅/❌ | |
| 4.2 | 超时 | ✅/❌ | |
| 4.3 | 磁盘空间不足 | ✅/❌ | |
| 5.1 | 缓存优先策略 | ✅/❌ | |
| 5.2 | 动态生成回退 | ✅/❌ | |
| 6.1 | 批量导出 | ✅/❌ | |
| 6.2 | 部分失败容错 | ✅/❌ | |

### 发现的问题

| 问题编号 | 严重程度 | 问题描述 | 重现步骤 | 状态 |
|---------|---------|---------|---------|------|
| 1 | 高/中/低 | | | 待修复/已修复 |

### 测试总结

- **测试日期：** YYYY-MM-DD
- **测试人员：** 
- **测试环境：** 
- **通过率：** X/Y (X%)
- **主要发现：** 
- **建议：** 

---

## 自动化测试脚本

运行以下命令执行自动化测试：

```bash
# 生成测试数据
npm run test:manual:setup

# 运行自动化验证
npm run test:manual:verify

# 生成测试报告
npm run test:manual:report
```

---

## 附录：测试数据生成脚本

参见 `tasks/tests/manual-test-data-generator.js`
