# æ•°æ®ç›®å½•è¯´æ˜

æœ¬ç›®å½•ç”¨äºå­˜å‚¨ Enterprise Knowledge Hub çš„æ‰€æœ‰æ•°æ®æ–‡ä»¶ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ yuque.json             # è¯­é›€æºé…ç½®
â”‚   â”œâ”€â”€ yuque.json.bak         # è¯­é›€æºé…ç½®å¤‡ä»½
â”‚   â”œâ”€â”€ tasks.json             # å¯¼å‡ºä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ tasks.json.bak         # å¯¼å‡ºä»»åŠ¡é…ç½®å¤‡ä»½
â”‚   â”œâ”€â”€ items.json             # æ–‡æ¡£å…ƒæ•°æ®
â”‚   â””â”€â”€ items.json.bak         # æ–‡æ¡£å…ƒæ•°æ®å¤‡ä»½
â”œâ”€â”€ documents/                  # æ–‡æ¡£å†…å®¹ç›®å½•
â”‚   â”œâ”€â”€ {docId}.json           # æ–‡æ¡£å†…å®¹æ–‡ä»¶
â”‚   â”œâ”€â”€ {docId}.json.bak       # æ–‡æ¡£å†…å®¹å¤‡ä»½
â”‚   â””â”€â”€ ...
â””â”€â”€ assets/                     # èµ„æºæ–‡ä»¶ç›®å½•
    â””â”€â”€ {sourceId}/            # æŒ‰æ•°æ®æºåˆ†ç»„
        â””â”€â”€ {docId}/           # æŒ‰æ–‡æ¡£åˆ†ç»„
            â”œâ”€â”€ image1.png     # å›¾ç‰‡æ–‡ä»¶
            â”œâ”€â”€ image2.jpg     # å›¾ç‰‡æ–‡ä»¶
            â”œâ”€â”€ attachment.pdf # é™„ä»¶æ–‡ä»¶
            â””â”€â”€ ...
```

## ğŸ“„ æ–‡ä»¶æ ¼å¼è¯´æ˜

### é…ç½®æ–‡ä»¶ (configs/)

#### yuque.json
å­˜å‚¨è¯­é›€çŸ¥è¯†åº“æºçš„é…ç½®ä¿¡æ¯ã€‚

```json
{
  "configs": [
    {
      "id": "unique-id",
      "name": "é…ç½®åç§°",
      "domain": "https://www.yuque.com",
      "login": "team-login",
      "repoSlug": "repo-slug",
      "token": "access-token"
    }
  ]
}
```

#### tasks.json
å­˜å‚¨å¯¼å‡ºä»»åŠ¡çš„é…ç½®å’ŒçŠ¶æ€ã€‚

```json
{
  "tasks": [
    {
      "id": "task-id",
      "name": "ä»»åŠ¡åç§°",
      "sourceId": "yuque-source-id",
      "trigger": "manual",
      "schedule": null,
      "lastRun": "2024-01-01T00:00:00.000Z",
      "status": "success"
    }
  ]
}
```

#### items.json
å­˜å‚¨æ–‡æ¡£å’Œæ–‡ä»¶å¤¹çš„å…ƒæ•°æ®ã€‚

```json
{
  "items": [
    {
      "id": "doc-id",
      "name": "æ–‡æ¡£æ ‡é¢˜",
      "type": "document",
      "format": "markdown",
      "sourceId": "yuque-source-id",
      "sourceName": "è¯­é›€æºåç§°",
      "author": "ä½œè€…",
      "updatedAt": "2024-01-01T00:00:00.000Z",
      "tags": ["yuque:source-id"],
      "parentId": null
    }
  ]
}
```

### æ–‡æ¡£æ–‡ä»¶ (documents/)

æ¯ä¸ªæ–‡æ¡£å†…å®¹å­˜å‚¨ä¸ºç‹¬ç«‹çš„ JSON æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºæ–‡æ¡£ IDã€‚

```json
{
  "id": "doc-id",
  "body": "Markdown å†…å®¹",
  "body_html": "HTML å†…å®¹",
  "format": "markdown",
  "assets": {
    "https://original-url.com/image.png": "assets/source-id/doc-id/image.png"
  }
}
```

### èµ„æºæ–‡ä»¶ (assets/)

èµ„æºæ–‡ä»¶æŒ‰ç…§ `{sourceId}/{docId}/{filename}` çš„ç»“æ„ç»„ç»‡ï¼Œä¿æŒåŸå§‹æ–‡ä»¶åå’Œæ ¼å¼ã€‚

## ğŸ”’ å¤‡ä»½æœºåˆ¶

ç³»ç»Ÿåœ¨å†™å…¥æ–‡ä»¶å‰ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆ`.bak` åç¼€ï¼‰ï¼š

1. **å†™å…¥å‰**: åˆ›å»º `{filename}.bak` å¤‡ä»½æ–‡ä»¶
2. **å†™å…¥ä¸­**: å†™å…¥æ–°å†…å®¹åˆ° `{filename}`
3. **å†™å…¥å**: åˆ é™¤å¤‡ä»½æ–‡ä»¶

å¦‚æœå†™å…¥å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä»å¤‡ä»½æ–‡ä»¶æ¢å¤ã€‚

### æ‰‹åŠ¨æ¢å¤

å¦‚æœæ•°æ®æ–‡ä»¶æŸåï¼Œå¯ä»¥æ‰‹åŠ¨ä»å¤‡ä»½æ¢å¤ï¼š

```bash
# æ¢å¤é…ç½®æ–‡ä»¶
cp data/configs/yuque.json.bak data/configs/yuque.json

# æ¢å¤æ–‡æ¡£æ–‡ä»¶
cp data/documents/doc-123.json.bak data/documents/doc-123.json
```

## ğŸ” æ–‡ä»¶é”æœºåˆ¶

ç³»ç»Ÿä½¿ç”¨æ–‡ä»¶é”é˜²æ­¢å¹¶å‘å†™å…¥å†²çªï¼š

- å†™å…¥æ–‡ä»¶å‰è‡ªåŠ¨è·å–é”
- å†™å…¥å®Œæˆåè‡ªåŠ¨é‡Šæ”¾é”
- é”è¶…æ—¶æ—¶é—´ï¼š10 ç§’
- é”æ–‡ä»¶ä½ç½®ï¼š`{filename}.lock`

## ğŸ“Š æ•°æ®ç»Ÿè®¡

æŸ¥çœ‹æ•°æ®ç›®å½•å¤§å°ï¼š

```bash
# macOS/Linux
du -sh data/

# æŸ¥çœ‹å„å­ç›®å½•å¤§å°
du -sh data/*/
```

æŸ¥çœ‹æ–‡ä»¶æ•°é‡ï¼š

```bash
# é…ç½®æ–‡ä»¶æ•°é‡
ls -1 data/configs/*.json | wc -l

# æ–‡æ¡£æ•°é‡
ls -1 data/documents/*.json | wc -l

# èµ„æºæ–‡ä»¶æ•°é‡
find data/assets -type f | wc -l
```

## ğŸ—‘ï¸ æ•°æ®æ¸…ç†

### æ¸…ç†å¤‡ä»½æ–‡ä»¶

```bash
# åˆ é™¤æ‰€æœ‰å¤‡ä»½æ–‡ä»¶
find data/ -name "*.bak" -delete
```

### æ¸…ç†é”æ–‡ä»¶

```bash
# åˆ é™¤æ‰€æœ‰é”æ–‡ä»¶ï¼ˆä»…åœ¨ç¡®è®¤æ²¡æœ‰è¿›ç¨‹è¿è¡Œæ—¶ï¼‰
find data/ -name "*.lock" -delete
```

### æ¸…ç†ç‰¹å®šæ•°æ®æº

```bash
# åˆ é™¤ç‰¹å®šæ•°æ®æºçš„æ‰€æœ‰èµ„æº
rm -rf data/assets/{sourceId}/

# åˆ é™¤ç‰¹å®šæ•°æ®æºçš„æ‰€æœ‰æ–‡æ¡£
# éœ€è¦æ‰‹åŠ¨ç­›é€‰ï¼Œå› ä¸ºæ–‡æ¡£ ID åŒ…å«æ•°æ®æºä¿¡æ¯
```

## ğŸ’¾ æ•°æ®å¤‡ä»½

### å®Œæ•´å¤‡ä»½

```bash
# åˆ›å»ºå®Œæ•´å¤‡ä»½
tar -czf ekh-backup-$(date +%Y%m%d).tar.gz data/

# æ¢å¤å¤‡ä»½
tar -xzf ekh-backup-20240101.tar.gz
```

### å¢é‡å¤‡ä»½

ä½¿ç”¨ rsync è¿›è¡Œå¢é‡å¤‡ä»½ï¼š

```bash
# å¤‡ä»½åˆ°å¤–éƒ¨ç›®å½•
rsync -av --delete data/ /path/to/backup/data/

# ä»å¤‡ä»½æ¢å¤
rsync -av --delete /path/to/backup/data/ data/
```

## ğŸš« æ³¨æ„äº‹é¡¹

1. **ä¸è¦æ‰‹åŠ¨ç¼–è¾‘æ•°æ®æ–‡ä»¶**: é™¤éä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆ
2. **ä¸è¦åˆ é™¤æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶**: ç¡®ä¿åº”ç”¨å·²åœæ­¢
3. **å®šæœŸå¤‡ä»½**: å»ºè®®æ¯å‘¨å¤‡ä»½ä¸€æ¬¡æ•°æ®ç›®å½•
4. **æ£€æŸ¥ç£ç›˜ç©ºé—´**: å¤§é‡æ–‡æ¡£å’Œèµ„æºä¼šå ç”¨è¾ƒå¤šç©ºé—´
5. **Git å¿½ç•¥**: æ­¤ç›®å½•å·²æ·»åŠ åˆ° `.gitignore`ï¼Œä¸ä¼šæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

## ğŸ“ æ•°æ®è¿ç§»

### è¿ç§»åˆ°æ–°æœºå™¨

1. åœæ­¢åº”ç”¨
2. å¤åˆ¶æ•´ä¸ª `data/` ç›®å½•åˆ°æ–°æœºå™¨
3. ç¡®ä¿ç›®å½•æƒé™æ­£ç¡®
4. å¯åŠ¨åº”ç”¨

### ä» localStorage è¿ç§»

å¦‚æœä½ ä¹‹å‰ä½¿ç”¨ localStorage ç‰ˆæœ¬ï¼Œéœ€è¦æ‰‹åŠ¨è¿ç§»æ•°æ®ï¼š

1. åœ¨æ—§ç‰ˆæœ¬ä¸­å¯¼å‡ºæ‰€æœ‰é…ç½®å’Œä»»åŠ¡
2. åœ¨æ–°ç‰ˆæœ¬ä¸­é‡æ–°åˆ›å»ºé…ç½®å’Œä»»åŠ¡
3. é‡æ–°æ‰§è¡Œå¯¼å‡ºä»»åŠ¡

## ğŸ”§ å¼€å‘è°ƒè¯•

### æŸ¥çœ‹æ–‡ä»¶å†…å®¹

```bash
# æŸ¥çœ‹é…ç½®æ–‡ä»¶
cat data/configs/yuque.json | jq .

# æŸ¥çœ‹æ–‡æ¡£å†…å®¹
cat data/documents/doc-123.json | jq .
```

### ç›‘æ§æ–‡ä»¶å˜åŒ–

```bash
# macOS
fswatch -o data/ | xargs -n1 -I{} echo "Files changed"

# Linux
inotifywait -m -r data/
```

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°æ•°æ®ç›¸å…³é—®é¢˜ï¼š

1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
2. æ£€æŸ¥æ–‡ä»¶æƒé™
3. æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
4. å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—ï¼ˆREADME.mdï¼‰
